<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate MODIS product covariates in multiple CPU threads — calc_modis • beethoven</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate MODIS product covariates in multiple CPU threads — calc_modis"><meta property="og:description" content="calc_modis essentially runs modis_worker function
in each thread (subprocess). Based on daily resolution, each day's workload
will be distributed to each thread. With product argument,
the files are processed by a customized function where the unique structure
and/or characteristics of the products are considered. nthreads
argument should be carefully selected in consideration of the machine's
CPU and memory capacities as products have their own memory pressure.
Overall, this function and dependent routines assume that the file system
can handle concurrent access to the (network) disk by multiple processes.
File system characteristics, package versions, and hardware settings/
specification can affect the processing efficiency.
sites should be sf object as it is exportable to
parallel workers."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">beethoven</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/cross_validation_types.html">Spatiotemporal cross validation types</a>
    </li>
    <li>
      <a href="../articles/download_functions.html">download_data() and NASA EarthData Account</a>
    </li>
    <li>
      <a href="../articles/epa_download.html">Downloading EPA Daily Data</a>
    </li>
    <li>
      <a href="../articles/prediction_points.html">Generate prediction points</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/Spatiotemporal-Exposures-and-Toxicology/beethoven/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate MODIS product covariates in multiple CPU threads</h1>
    <small class="dont-index">Source: <a href="https://github.com/Spatiotemporal-Exposures-and-Toxicology/beethoven/blob/HEAD/R/calculate_covariates.R" class="external-link"><code>R/calculate_covariates.R</code></a></small>
    <div class="hidden name"><code>calc_modis.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>calc_modis essentially runs <code>modis_worker</code> function
in each thread (subprocess). Based on daily resolution, each day's workload
will be distributed to each thread. With <code>product</code> argument,
the files are processed by a customized function where the unique structure
and/or characteristics of the products are considered. <code>nthreads</code>
argument should be carefully selected in consideration of the machine's
CPU and memory capacities as products have their own memory pressure.
Overall, this function and dependent routines assume that the file system
can handle concurrent access to the (network) disk by multiple processes.
File system characteristics, package versions, and hardware settings/
specification can affect the processing efficiency.</p>
<p>sites should be sf object as it is exportable to
parallel workers.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_modis</span><span class="op">(</span></span>
<span>  <span class="va">path</span>,</span>
<span>  product <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MOD11A1"</span>, <span class="st">"MOD13A2"</span>, <span class="st">"MOD06_L2"</span>, <span class="st">"VNP46A2"</span>, <span class="st">"MOD09GA"</span>, <span class="st">"MCD19A2"</span><span class="op">)</span>,</span>
<span>  <span class="va">sites</span>,</span>
<span>  id_col <span class="op">=</span> <span class="st">"site_id"</span>,</span>
<span>  <span class="va">name_covariates</span>,</span>
<span>  radius <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0L</span>, <span class="fl">1000L</span>, <span class="fl">10000L</span>, <span class="fl">50000L</span><span class="op">)</span>,</span>
<span>  subdataset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fun_summary <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  nthreads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">parallelly</span><span class="fu">::</span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableWorkers.html" class="external-link">availableWorkers</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  package_list_add <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  export_list_add <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>path</dt>
<dd><p>character. List of HDF files.</p></dd>


<dt>product</dt>
<dd><p>character(1). MODIS product. Should be one of
<code>c("MOD11A1", "MOD13A2", "MOD06_L2", "VNP46A2", "MOD09GA", "MCD19A2")</code></p></dd>


<dt>sites</dt>
<dd><p>sf object. Unique sites where covariates
will be calculated.</p></dd>


<dt>id_col</dt>
<dd><p>character(1). Site identifier. Default is <code>"site_id"</code></p></dd>


<dt>name_covariates</dt>
<dd><p>character. Name header of covariates.
e.g., <code>"MOD_NDVIF_0_"</code>.
The calculated covariate names will have a form of
'name_covariateszero-padded buffer radius in meters',
e.g., 'MOD_NDVIF_0_50000' where 50 km radius circular buffer
was used to calculate mean NDVI value.</p></dd>


<dt>radius</dt>
<dd><p>numeric. Radii to calculate covariates.
Default is <code>c(0, 1000, 10000, 50000)</code>.</p></dd>


<dt>subdataset</dt>
<dd><p>Index or search pattern of subdataset.
Pattern is not accepted when product is <code>"VNP46A2"</code> or
<code>"MOD06_L2"</code></p></dd>


<dt>fun_summary</dt>
<dd><p>character or function. Function to summarize
extracted raster values.</p></dd>


<dt>nthreads</dt>
<dd><p>integer(1). Number of threads to be used
to calculate covariates.</p></dd>


<dt>package_list_add</dt>
<dd><p>character. A vector with package names to load
these in each thread. Note that <code>sf</code>, <code>terra</code>,
<code>exactextractr</code>, <code>doParallel</code>, <code>parallelly</code>,
and <code>dplyr</code>
are the default packages to be loaded.</p></dd>


<dt>export_list_add</dt>
<dd><p>character. A vector with object names to export
to each thread. It should be minimized to spare memory.</p></dd>

</dl></div>
    <div id="note">
    <h2>Note</h2>
    <p>See details for setting parallelization
<code><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></code>,
<code><a href="https://parallelly.futureverse.org/reference/makeClusterPSOCK.html" class="external-link">makeClusterPSOCK</a></code>,
<code><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></code>,
<code><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></code></p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Kyle Messier, Insang Song, Eva Marques, Mitchell Manware, Daniel Zilber, Anisha Singh, Lara Clark, Cavin Ward-Caviness.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

